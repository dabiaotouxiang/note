# 加密算法三大类
1. 哈希函数（散列） md5 SHA1/256/512 HMAC(一种加密方式)
2. 对称加密 DES 3DES AES(高级加密标准，apple的钥匙串访问)
3. 非对称加密

## HASH概述
### 特点
1. 算法公开
2. 相同数据结果相同
3. 不同数据，如MD5得到的结果默认是相同的位数，128位二进制，用16进制表示为32位
4. 没法逆运算
5. 属于信息摘要，信息指纹，用来做数据识别

### 用途
1. 密码加密
2. 搜索引擎
3. 版权
4. 数字签名

### 用户信息的保护守则
1. 网络上不允许明文传递用户敏感信息
2. 本地不允许明文保存用户敏感信息

### 密码加密
1. RSA加密有隐患
    1. 服务器必然要明文保存一个密码
    2. 所以现在没有找回密码了
2. MD5直接加密
    1. 容易被暴力破解，反查询 www.cmd5.com
    2. 命令行计算  `md5 -s 123456`
3. 加盐
    1. 加一个足够长，足够复杂的字符串
    2. 可以密码加字符串再进行md5.
    3. 盐是静态字符串，反编译耗时非常长
    4. 开发人员知道，离职后的保密问题
    5. 盐是固定的，一点泄露了就不安全了，就可能被暴力破解
4. HMAC 一种加密方式
    1. 使用一个密钥，做两次散列
    2. 密钥来自服务器，动态的，一个账号一个key，还可以更新
    3. 逆向分析可以得到key，但是对其他用户没影响
    4. key的获取在注册和新机登陆的时候。保存在钥匙串中。新机登录的时候，是先通过设备锁或者是验证码进行登录，再将key由服务器发送到设备
    5. key可以定期更换

依然存在的弊端，可以通过中间人攻击，直接获取加密过的登录包，直接发包验证

5. 保护发送给服务器的包
    1. 可以加时间戳，或者类似的技术
    2. 即在上面的key加密后进行再加上时间戳进行加密，时间为服务器时间，因为手机时间可以随便改，用分钟
    3. 手机 ((HMAC哈希值) + 当前分钟).md5
    4. 服务器 ((HMAC哈希值) + 当前分钟).md5 如果恰好到了下一分钟，再计算一次((HMAC哈希值) + 当前分钟上一分钟).md5

### 搜索引擎

拆词搜索，将每个词的hash拿到，然后把每个词的进行按位相加，这样顺序就没影响了

### 版权

百度云秒传，或者是色情检测(压缩一下可以避免检测，改变HASH值)

### 数字签名

数字信息鉴别

对支付信息进行一次HASH，将HASH和原始数据发送给服务器，但是HASH也有可能被篡改。对HASH进行RSA加密。服务器对RSA进行解密，对原始数据进行HASH，两者对比，来确定数据有效性

RSA加密过的就叫数字签名

### 散列的碰撞

必然存在，偶然发生

### 代码签名
对二进制可执行文件进行文件签名，做二进制文件的校验

## 对称加密算法

### 常见算法
1. DES 数据加密标准 (用的少，加密强度不够)
2. 3DEC 3个密钥，对相同数据进行3次加密，增加强度，但是由于密钥的保护很麻烦，3DES保护更复杂
3. AES 高级密码标准 apple钥匙串加密

异或也是一种常规的加密处理手段，游戏里面

### 对称加密应用模式
#### ECB (Electronic Code Book): 电子密码本模式。每一块数据，独立加密。

* 最基本的加密模式，相同的明文将永远加密位相同的密文，无初始向量，容易受到码本重放攻击，一般很少用
#### CBC(Cipher Block Chaining): 密码分组链接模式。使用一个密钥和一个初始化向量\[IV\]对数据进行加密

* 明文呗加密前要与前面的密文进行异或运算后再加密，因此只要选择不同的初始化向量，相同的密文加密后会形成不同的密文，这是目前应用最广泛的模式。CBC加密后的密文是上下文相关的，但是明文的错误不会传递到后续分组，但是一个分组丢失，后面的分组将全部作废(同步错误)。
* CBC可以有效的保证数据的完整性，如果一个数据块在传递时丢失或者改变，后面的数据将无法正常解密。防窃听

#### 终端进行对称加密

ecb方式
```
openssl enc -des-ecb -K 616263 -nosalt -in message.txt -out msg1.bin
```

cbc方式
```
openssl enc -des-cbc -iv 0102030405060708 -K 616263 -nosalt -in message.txt -out msg1.bin
```

#### CCCrypt函数 

11个参数，对称加密的算法核心，加解密都用它。apple系统函数

参数
  1. kCCDecrypt 解密
     kCCEncrypt 加密
  2. 加密算法
  3. 加密方式
  4. 加密密钥
  5. 密钥长度
  6. 初始化向量(cbc模式下)，ECB不需要指定
  7. 加密的数据
  8. 加密的数据长度
  9. 缓冲区，存放密文的
  10. 缓冲区大小
  11. 加密结果大小

**CCCrypt直接用的话，可能会被加系统断言调试，得到加密前的参数，参数7，系统级的函数不能去符号，不要直接把数据给系统级函数，可以先用异或之类的加密一下**