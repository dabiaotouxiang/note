# 越狱
通过iOS系统安全启动链漏洞，从而禁止掉信任链中负责验证的组件。拿到iOS系统最大权限ROOT权限
现在基本上都是逆向的人在越狱
## iOS安全启动链
当启动一台iOS设备的时候，系统首先会从只读的ROM中读取初始化指令，也就是系统的引导程序(事实上所有的操作系统启动时都要经过这一步，只是过程略有不同)。这个引导ROM包含苹果官方权威认证的公钥，他会验证底层启动加载器(LLB)的签名，一旦验证通过后就启动系统。LLB会做一些基础工作，然后验证第二级引导程序iBoot。iBoot启动后，设备就可以进入恢复模式或启动内核。在iBoot验证完内核签名的合法性之后，整个启动层序开始步入正轨：家在驱动程序，检测设备，启动系统守护进程。这个信任链会确保所有的系统组件都由苹果官方写入，签名，分发，不能来自第三方机构
![](./安全启动链图示.png)
越狱的原理就是攻击这一信任链。所有的越狱工具的制作者都要找到这一信任链上的漏洞，从而禁止掉信任链中负责验证的组件。拿到iOS系统的ROOT权限。
## 越狱
完美越狱(可重启)，非完美越狱(不可重启)。

现在一般用Uncover或者是checkra1n
## 常用插件
Apple File Conduit "2" 访问目录权限
AppSync Unified 绕过签名检测，安装没有经过签名的app
adv-cmds 命令行工具包
PowerSelector LDRestart
## 软件
使用爱思助手 
pp助手已经不能用了

# 链接手机
使用OpenSSH插件链接手机，进行远程控制或者传输文件

可以用爱思助手的小工具，也可以用cydia安装openssh
## openssh插件
对于iOS的两个用户 root mobile 默认密码都是alpine

对于AFC2没有完全安装的时候，功能不全的时候爱思助手无法访问根目录，可以通过ssh的root去访问

## 修改密码
可以用passwd命令去修改默认密码

root用户可以修改所有的密码      

安装插件后建议修改一下密码

## SSH登陆过程
1. 请求连接到iphone手机
2. 手机将公钥发给mac电脑(第一次登陆的时候会问要不要保存公钥，后面就不用再用iphone发了，当中间人攻击的时候，会发现公钥的变化，预防中间人攻击)
3. Mac电脑通过收到的公钥加密登陆密码
4. iphone利用私钥解密登陆密码，是否允许登陆

## 风险
中间人攻击，伪装成iphone，去截获client的请求，将自己的公钥发给client，偷取密码

## 免密码登陆
原理是用户先将自己的公钥存储到iphone上，然后登陆的时候iphone先将一个随机的字符串发送到client，然后client用自己的私钥加密，再发给iphone，iphone用公钥进行解密，然后看看是不是自己发送的随机字符串，是的话说明可以登陆
1. ssh-keygen 生成公钥
2. 拷贝公钥给SSH服务器 ssh-copy-id 用户名@服务器ip

# USB登陆
苹果有一个服务，叫usbmuxd，这个服务主要用于在USB协议上实现多路TCP链接
## 端口映射
1. 
```
python tcprelay.py -t 远程端口号:映射的本地端口号
```
然后就用ssh链接就行了
2. iproxy brew 安装
```
iproxy 本地端口:远程端口
```

# 拷贝文件
1. scp scp 可以直接用wifi，也可以走本地的usb端口转发
2. rsync

# APP瘦身
1. 获取可执行文件
2. lipo Keep -thin arm64 -output arm64_keep
3. 用瘦身过的去替换包里面的
4. 重新打包